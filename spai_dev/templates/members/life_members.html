{% extends 'main.html' %}
{% load static %}
{% block cssfiles %}
<link rel="stylesheet" href="{% static 'css/sub/header.css' %}">
<link rel="stylesheet" href="{% static 'css/sub/footer.css' %}">
<link rel="stylesheet" href="{% static 'css/sub/members.css' %}">
{% endblock %}

{% block header %}
{% include 'header.html' %}
{% endblock %}

{% block content %}
<div class="life-h">
    <h1>life members</h1>
    <form class="search-wrapper" style="margin-bottom:15px;" method="get" action="{% url 'search_lm' %}">
        <input type="text" name="query" class="search-input" placeholder="search life members..."
               value="{{ query }}">
        <button type="submit" class="search-button">
            <img src="{% static 'image/search.svg' %}" alt="Search">
        </button>
    </form>
</div>
<div class="news-tabs">
    <ul class="tab-list">
        <li class="tab-item active" data-tab="new">New</li>
        <li class="tab-item" data-tab="life">Life Members</li>
        <li class="tab-item" data-tab="active-m">Active</li>
        <li class="tab-item" data-tab="non-active">Non-active</li>
    </ul>
</div>
<!-- <div class="tabs">
    <div class="tab" data-tab="new">New Members</div>
    <div class="tab" data-tab="life">Life Members</div>
</div> -->

<table class="table active" id="new">
    <thead>
        <tr>
            <th onclick="sortTable(0)">Registration No <span class="sort-icon">&#9650;&#9660;</span></th>
            <th onclick="sortTable(1)">Username<span class="sort-icon">&#9650;&#9660;</span></th>
            <th class="email">Email</th>
            <th onclick="sortTable(3)">First Name <span class="sort-icon">&#9650;&#9660;</span></th>
            <th onclick="sortTable(4)">Register Date <span class="sort-icon">&#9650;&#9660;</span></th>
            <th class="status">Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for user in new_members %}
        <tr>
            <td class="email">{{ user.reg_no }}</td>
            <td class="username">
                {% if user.photo %}
                <img src="{{ user.photo.url }}" alt="">
                {% else %}
                <img src="{% static 'image/profile-icon.svg' %}" alt="photo">
                {% endif %}
                {{ user.username }}
            </td>
            <td class="email">{{ user.email }}</td>
            <td>{{ user.first_name }} {{ user.last_name }}</td>
            <td>{{ user.date_created }}</td>
            <td class="status">{{ user.next_step }}</td>
            <td>
                <a href="{% url 'individual_user_details' user.slug_value %}">
                    <div class="view">
                        <img src="{% static 'image/eye.svg' %}" alt="">
                        <p>View</p>
                    </div>
                </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
    let ascending = true;

    function sortTable(columnIndex) {
        const table = document.getElementById("new");
        const rows = Array.from(table.tBodies[0].rows);
        const sortFunction = (a, b) => {
            let valA = a.cells[columnIndex].textContent.trim();
            let valB = b.cells[columnIndex].textContent.trim();

            // Parse as numbers or dates if necessary
            if (!isNaN(valA) && !isNaN(valB)) {
                valA = parseFloat(valA);
                valB = parseFloat(valB);
            } else if (columnIndex === 4) { // Assuming column 4 is the date
                valA = new Date(valA);
                valB = new Date(valB);
            }

            if (valA < valB) return ascending ? -1 : 1;
            if (valA > valB) return ascending ? 1 : -1;
            return 0;
        };

        rows.sort(sortFunction);

        // Re-append sorted rows to the table
        rows.forEach(row => table.tBodies[0].appendChild(row));

        // Toggle sorting order for next click
        ascending = !ascending;
    }
</script>

<style>
    th {
        cursor: pointer;
    }
    .sort-icon {
        font-size: 0.8em;
        margin-left: 5px;
    }
</style>


<table class="table" id="life">
    <thead>
        <tr>
            <th onclick="sortTable(0)">Registration No <span class="sort-icon">&#9650;&#9660;</span></th>
            <th onclick="sortTable(1)">Name <span class="sort-icon">&#9650;&#9660;</span></th>
            <th class="email">Email</th>
            <th onclick="sortTable(3)">Membership Date<span class="sort-icon">&#9650;&#9660;</span></th>
            <th class="status">Active</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
    {% for user in life_members %}
    <tr>
        <td>{{user.reg_no}}</td>
        <td class="username">
            {{user.name}}
        </td>
        <td class="email">{{user.email}}</td>
        <td>{{user.membership_date}}</td>
        <td class="status">{{user.active}}</td>
        <td>
            <a href="{% url 'life_member_info' user.uid %}">
                <div class="view">
                    <img src="{% static 'image/eye.svg' %}" alt="">
                    <p>View</p>
                </div>
            </a>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>

<table class="table" id="active-m">
    <thead>
        <tr>
            <th onclick="sortTable(0)">Registration No <span class="sort-icon">&#9650;&#9660;</span></th>
            <th onclick="sortTable(1)">Username <span class="sort-icon">&#9650;&#9660;</span></th>
            <th class="email">Email</th>
            <th onclick="sortTable(3)">First Name</th>
            <th onclick="sortTable(4)">Register Date <span class="sort-icon">&#9650;&#9660;</span></th>
            <th class="status">Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>

    {% for user in active%}
    <tr>
        <td class="email">{{user.reg_no}}</td>
        <td class="username">
            {% if user.photo %}
            <img src="{{ user.photo.url }}" alt="">
            {% else %}
            <img src="{% static 'image/profile-icon.svg' %}" alt="photo">
            {% endif %}
            {{user.username}}
        </td>
        <td class="email">{{user.email}}</td>
        <td>{{user.first_name}} {{user.last_name}}</td>
        <td>{{user.date_created}}</td>
        <td class="status">{{user.next_step}}</td>
        <td>
            <a href="{% url 'individual_user_details' user.slug_value %}">
                <div class="view">
                    <img src="{% static 'image/eye.svg' %}" alt="">
                    <p>View</p>
                </div>
            </a>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>
<table class="table" id="non-active">
    <thead>
        <tr>
            <th onclick="sortTable(0)">Registration No <span class="sort-icon">&#9650;&#9660;</span></th>
            <th onclick="sortTable(1)">Username <span class="sort-icon">&#9650;&#9660;</span></th>
            <th class="email">Email</th>
            <th onclick="sortTable(3)">First Name</th>
            <th onclick="sortTable(4)">Register Date <span class="sort-icon">&#9650;&#9660;</span></th>
            <th class="status">Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>

    {% for user in non_active%}
    <tr>
        <td class="email">{{user.reg_no}}</td>
        <td class="username">
            {% if user.photo %}
            <img src="{{ user.photo.url }}" alt="">
            {% else %}
            <img src="{% static 'image/profile-icon.svg' %}" alt="photo">
            {% endif %}
            {{user.username}}
        </td>
        <td class="email">{{user.email}}</td>
        <td>{{user.first_name}} {{user.last_name}}</td>
        <td>{{user.date_created}}</td>
        <td class="status">{{user.next_step}}</td>
        <td>
            <a href="{% url 'individual_user_details' user.slug_value %}">
                <div class="view">
                    <img src="{% static 'image/eye.svg' %}" alt="">
                    <p>View</p>
                </div>
            </a>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>
{% endblock %}


{% block footer %}
{% include 'footer.html' %}
{% endblock %}
{% block jsfile %}
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelector('.menu-icon').addEventListener('click', function () {
            document.querySelector('.navbar').classList.toggle('active');
        });
    });
</script>
<script>
    document.querySelectorAll('.tab-item').forEach(item => {
        item.addEventListener('click', function () {
            // Remove active class from all tabs
            document.querySelectorAll('.tab-item').forEach(tab => tab.classList.remove('active'));
            // Add active class to the clicked tab
            this.classList.add('active');

            // Hide all tab panels
            document.querySelectorAll('.table').forEach(panel => panel.classList.remove('active'));
            // Show the selected tab panel
            const targetPanel = document.getElementById(this.dataset.tab);
            targetPanel.classList.add('active');
        });
    });

</script>
{% endblock %}