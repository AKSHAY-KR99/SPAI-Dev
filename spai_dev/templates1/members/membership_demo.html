{% extends 'main.html' %}
{% load static %}
{% block header %}
{% include 'header.html' %}
{% endblock %}
{% block content %}
<h1>Membership</h1>
<form method="post" id="myForm" onsubmit="return validateForm()">
    {% csrf_token %}
    {% if form.errors %}
        <div class="error-messages">
            {% for field in form %}
                {% if field.errors %}
                    <ul>
                        {% for error in field.errors %}
                            <li>{{ error|escape }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            {% endfor %}
        </div>
    {% endif %}
    <div>
        <label for="email">Email Address:</label>
        <input type="email" id="email" name="email" required>
        <p class="errorClasses" id="noneEmail">error</p>
        <p class="errorClasses" id="invalidEmail">error</p>
    </div>
    <div>
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required>
        <p class="errorClasses" id="noneUsername">error</p>
        <p class="errorClasses" id="invalidUsername">error</p>
    </div>
    <div>
        <label for="first_name">First Name:</label>
        <input type="text" id="first_name" name="first_name">
        <p class="errorClasses" id="noneFirstName">error</p>
    </div>
    <div>
        <label for="last_name">Last Name:</label>
        <input type="text" id="last_name" name="last_name">
    </div>
    <div>
        <label for="state">State:</label>
        <select name="state" id="state">

        </select>
        <p class="errorClasses" id="noneState">error</p>
    </div>
    <div>
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required>
        <p class="errorClasses" id="nonePassword">error</p>
        <p class="errorClasses" id="invalidPassword">error</p>
    </div>
    <div>
        <label for="confirm_password">Confirm Password:</label>
        <input type="password" id="confirm_password" name="confirm_password" required>
        <p class="errorClasses" id="noneMatch">error</p>
    </div>
    <input type="submit" value="Add me close">
</form>
{% endblock %}

{% block footer %}
{% include 'footer.html' %}
<script>
    const stateSelected = document.querySelector("#state")

    const states = ["Select state","Andhra Pradesh", "Arunachal Pradesh", "Assam", "Bihar", "Chhattisgarh",
        "Goa", "Gujarat", "Haryana", "Himachal Pradesh", "Jharkhand", "Karnataka", "Kerala", "Madhya Pradesh",
        "Maharashtra", "Manipur", "Meghalaya", "Mizoram", "Nagaland", "Odisha", "Punjab", "Rajasthan",
        "Sikkim", "Tamil Nadu","Telangana","Tripura", "Uttar Pradesh", "Uttarakhand", "West Bengal"]

    function populateStates(){
        let html_data = ""
        for(let i=0;i<states.length;++i){
            html_data += `<option>${states[i]}</option>`
        }
        stateSelected.innerHTML = html_data
    }

    populateStates()

    function validateForm() {
    const email = document.getElementById('email');
    const username = document.getElementById('username');
    const firstName = document.getElementById('first_name');
    const lastName = document.getElementById('last_name');
    const state = document.getElementById('state');
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirm_password');

    let emailError = false;
    let usernameError = false;
    let passwordError = false;
    let firstNameError = false;
    let stateError = false;

    let errorCount = 0;

    if ((email == null) || (email == "")) {
        let errorText = document.querySelector("#noneEmail")
        errorText.innerHTML = "*Please provide email"
        errorText.style.visibility = "visible";
        errorCount += 1
    }

    if (!email.value.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)) {
        emailError = true;
        let errorText = document.querySelector("#invalidEmail")
        errorText.innerHTML = "*Please provide valid email id"
        errorText.style.visibility = "visible";
        errorCount += 1
    }

    if (username.value.length < 3) {
        usernameError = true;
        let errorText = document.querySelector("#noneUsername")
        errorText.innerHTML = '* Username must be at least 3 characters long'
        errorText.style.visibility = "visible";
        errorCount += 1
    }

    if ((firstName.value == null)||(firstName.value == "")){
        firstNameError = true;
        let errorText = document.querySelector("#noneFirstName")
        errorText.innerHTML = '* First name cannot be empty!'
        errorText.style.visibility = "visible";
        errorCount += 1
    }

    if (state.value == 'Select state'){
        stateError = true;
        let errorText = document.querySelector("#noneState")
        errorText.innerHTML = '* Select any state'
        errorText.style.visibility = "visible";
        errorCount += 1
    }

    if (password.value.length < 8 ||!password.value.match(/^(?=.*[A-Z])(?=.*[a-z])(?=.*[@#_!])/)) {
        passwordError = true;
        let errorText = document.querySelector("#invalidPassword")
        errorText.innerHTML = '* Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, and one of the following special characters: @, #, _,!'
        errorText.style.visibility = "visible";
        errorCount += 1
    }

    if (password.value!== confirmPassword.value) {
        passwordError = true;
        let errorText = document.querySelector("#noneMatch")
        errorText.innerHTML = '* Passwords do not match'
        errorText.style.visibility = "visible";
        errorCount += 1
    }

    if (emailError || usernameError || passwordError || firstNameError || stateError) {
        return false;
    }

    return true;
}

const formResult = validateForm()

if (formResult){
    document.getElementById('myForm').submit()
}
</script>
{% endblock %}